<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Context Extension System Architecture</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }

        .diagram-section {
            padding: 40px;
            border-bottom: 1px solid #eee;
        }

        .diagram-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 1.8em;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3498db;
        }

        .svg-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .description {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #3498db;
        }

        .flow-step {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .step-number {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .component {
            fill: #3498db;
            stroke: #2c3e50;
            stroke-width: 2;
        }

        .database {
            fill: #e74c3c;
            stroke: #c0392b;
            stroke-width: 2;
        }

        .process {
            fill: #2ecc71;
            stroke: #27ae60;
            stroke-width: 2;
        }

        .external {
            fill: #f39c12;
            stroke: #d68910;
            stroke-width: 2;
        }

        .arrow {
            fill: none;
            stroke: #2c3e50;
            stroke-width: 2;
            marker-end: url(#arrowhead);
        }

        .text {
            font-family: 'Segoe UI', sans-serif;
            font-size: 12px;
            fill: #2c3e50;
            text-anchor: middle;
        }

        .small-text {
            font-size: 10px;
            fill: #7f8c8d;
        }

        .highlight {
            fill: #9b59b6;
            stroke: #8e44ad;
            stroke-width: 2;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Multi-Strategy Context Extension System</h1>
            <p>Architecture Diagrams & Implementation Flow</p>
        </div>

        <div class="diagram-section">
            <h2 class="section-title">Overall System Architecture</h2>
            <div class="description">
                <p>This diagram shows how the three strategies work together to extend LLM context capabilities. Each
                    strategy operates independently but contributes to a unified context assembly that feeds into the
                    LLM.</p>
            </div>

            <div class="svg-container">
                <svg viewBox="0 0 1200 800" style="width: 100%; height: auto;">
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#2c3e50" />
                        </marker>
                        <pattern id="diagonalHatch" patternUnits="userSpaceOnUse" width="4" height="4">
                            <path d="M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2" stroke="#3498db" stroke-width="1"
                                opacity="0.3" />
                        </pattern>
                    </defs>

                    <!-- User Input -->
                    <rect x="50" y="50" width="120" height="60" class="component" rx="10" />
                    <text x="110" y="85" class="text">User Query</text>

                    <!-- Strategy 1: External Search RAG -->
                    <rect x="250" y="20" width="200" height="120" class="external" rx="15" />
                    <text x="350" y="50" class="text" style="font-weight: bold;">External Search RAG</text>

                    <rect x="270" y="70" width="80" height="30" class="component" rx="5" />
                    <text x="310" y="90" class="text small-text">Keyword Check</text>

                    <rect x="360" y="70" width="80" height="30" class="component" rx="5" />
                    <text x="400" y="90" class="text small-text">SLM Decision</text>

                    <rect x="270" y="105" width="160" height="25" class="process" rx="5" />
                    <text x="350" y="120" class="text small-text">Web Search & Content Clean</text>

                    <!-- Strategy 2: Memory Search RAG -->
                    <rect x="250" y="180" width="200" height="120" class="highlight" rx="15" />
                    <text x="350" y="210" class="text" style="font-weight: bold;">Memory Search RAG</text>

                    <rect x="270" y="230" width="70" height="30" class="component" rx="5" />
                    <text x="305" y="250" class="text small-text">Query Embed</text>

                    <rect x="350" y="230" width="90" height="30" class="component" rx="5" />
                    <text x="395" y="250" class="text small-text">Vector Search</text>

                    <rect x="270" y="270" width="160" height="25" class="process" rx="5" />
                    <text x="350" y="285" class="text small-text">Memory Fragment Assembly</text>

                    <!-- Strategy 3: In-Context Summarization -->
                    <rect x="250" y="340" width="200" height="120" class="database" rx="15" />
                    <text x="350" y="370" class="text" style="font-weight: bold;">In-Context Summary</text>

                    <rect x="270" y="390" width="70" height="30" class="component" rx="5" />
                    <text x="305" y="410" class="text small-text">Level Check</text>

                    <rect x="350" y="390" width="90" height="30" class="component" rx="5" />
                    <text x="395" y="410" class="text small-text">Summarize</text>

                    <rect x="270" y="430" width="160" height="25" class="process" rx="5" />
                    <text x="350" y="445" class="text small-text">Hierarchical Compression</text>

                    <!-- Context Assembly -->
                    <rect x="550" y="200" width="150" height="80" class="process" rx="15" />
                    <text x="625" y="230" class="text" style="font-weight: bold;">Context Assembly</text>
                    <text x="625" y="250" class="text small-text">Priority Integration</text>
                    <text x="625" y="265" class="text small-text">Token Management</text>

                    <!-- LLM -->
                    <rect x="800" y="180" width="150" height="120" class="highlight" rx="15" />
                    <text x="875" y="210" class="text" style="font-weight: bold;">Large Language</text>
                    <text x="875" y="230" class="text" style="font-weight: bold;">Model</text>
                    <text x="875" y="260" class="text small-text">Extended Context</text>
                    <text x="875" y="280" class="text small-text">Enhanced Response</text>

                    <!-- Response Output -->
                    <rect x="1030" y="210" width="120" height="60" class="component" rx="10" />
                    <text x="1090" y="245" class="text">Enhanced</text>
                    <text x="1090" y="260" class="text">Response</text>

                    <!-- Data Stores -->
                    <rect x="50" y="500" width="100" height="60" class="database" rx="10" />
                    <text x="100" y="525" class="text small-text">Message</text>
                    <text x="100" y="540" class="text small-text">Database</text>

                    <rect x="180" y="500" width="100" height="60" class="database" rx="10" />
                    <text x="230" y="525" class="text small-text">Vector</text>
                    <text x="230" y="540" class="text small-text">Database</text>

                    <rect x="310" y="500" width="100" height="60" class="database" rx="10" />
                    <text x="360" y="525" class="text small-text">Summary</text>
                    <text x="360" y="540" class="text small-text">Database</text>

                    <!-- Arrows -->
                    <line x1="170" y1="80" x2="240" y2="80" class="arrow" />
                    <line x1="170" y1="80" x2="240" y2="240" class="arrow" />
                    <line x1="170" y1="80" x2="240" y2="400" class="arrow" />

                    <line x1="450" y1="80" x2="540" y2="220" class="arrow" />
                    <line x1="450" y1="240" x2="540" y2="240" class="arrow" />
                    <line x1="450" y1="400" x2="540" y2="260" class="arrow" />

                    <line x1="700" y1="240" x2="790" y2="240" class="arrow" />
                    <line x1="950" y1="240" x2="1020" y2="240" class="arrow" />

                    <!-- Database connections -->
                    <line x1="100" y1="500" x2="310" y2="300" class="arrow" stroke-dasharray="5,5" opacity="0.6" />
                    <line x1="230" y1="500" x2="350" y2="300" class="arrow" stroke-dasharray="5,5" opacity="0.6" />
                    <line x1="360" y1="500" x2="400" y2="300" class="arrow" stroke-dasharray="5,5" opacity="0.6" />

                    <!-- Labels -->
                    <text x="200" y="40" class="text small-text">Query Analysis</text>
                    <text x="475" y="180" class="text small-text">Retrieved</text>
                    <text x="475" y="195" class="text small-text">Content</text>
                    <text x="750" y="180" class="text small-text">Unified</text>
                    <text x="750" y="195" class="text small-text">Context</text>
                </svg>
            </div>
        </div>

        <div class="diagram-section">
            <h2 class="section-title">Strategy 1: External Search RAG Flow</h2>
            <div class="description">
                <p>This strategy identifies when external knowledge is needed and retrieves relevant web content to
                    augment the LLM's response capabilities.</p>
            </div>

            <div class="svg-container">
                <svg viewBox="0 0 1000 600" style="width: 100%; height: auto;">
                    <!-- User Query -->
                    <ellipse cx="100" cy="100" rx="80" ry="40" class="component" />
                    <text x="100" y="105" class="text">User Query</text>

                    <!-- Keyword Analysis -->
                    <rect x="250" y="50" width="120" height="80" class="process" rx="10" />
                    <text x="310" y="80" class="text">Keyword</text>
                    <text x="310" y="95" class="text">Analysis</text>
                    <text x="310" y="115" class="text small-text">• Temporal terms</text>
                    <text x="310" y="125" class="text small-text">• Info requests</text>

                    <!-- Decision Diamond -->
                    <polygon points="450,50 500,90 450,130 400,90" class="highlight" />
                    <text x="450" y="95" class="text">Keywords?</text>

                    <!-- SLM Decision -->
                    <rect x="550" y="150" width="120" height="80" class="process" rx="10" />
                    <text x="610" y="180" class="text">SLM</text>
                    <text x="610" y="195" class="text">Decision</text>
                    <text x="610" y="215" class="text small-text">Search needed?</text>

                    <!-- Web Search -->
                    <rect x="400" y="280" width="120" height="80" class="external" rx="10" />
                    <text x="460" y="310" class="text">Web Search</text>
                    <text x="460" y="330" class="text small-text">• Google</text>
                    <text x="460" y="340" class="text small-text">• DuckDuckGo</text>

                    <!-- Content Processing -->
                    <rect x="600" y="280" width="120" height="80" class="process" rx="10" />
                    <text x="660" y="305" class="text">Content</text>
                    <text x="660" y="320" class="text">Processing</text>
                    <text x="660" y="340" class="text small-text">• Clean HTML</text>
                    <text x="660" y="350" class="text small-text">• Extract text</text>

                    <!-- Context Integration -->
                    <rect x="780" y="200" width="120" height="80" class="highlight" rx="10" />
                    <text x="840" y="230" class="text">Context</text>
                    <text x="840" y="245" class="text">Integration</text>
                    <text x="840" y="265" class="text small-text">Max 3 results</text>

                    <!-- No Search Path -->
                    <rect x="550" y="50" width="120" height="50" class="component" rx="10" />
                    <text x="610" y="80" class="text">No External</text>
                    <text x="610" y="90" class="text">Search</text>

                    <!-- Arrows -->
                    <line x1="180" y1="100" x2="240" y2="100" class="arrow" />
                    <line x1="370" y1="90" x2="390" y2="90" class="arrow" />
                    <line x1="450" y1="130" x2="550" y2="180" class="arrow" />
                    <line x1="500" y1="90" x2="540" y2="80" class="arrow" />
                    <line x1="610" y1="230" x2="460" y2="270" class="arrow" />
                    <line x1="520" y1="320" x2="590" y2="320" class="arrow" />
                    <line x1="720" y1="320" x2="780" y2="250" class="arrow" />
                    <line x1="670" y1="80" x2="780" y2="230" class="arrow" />

                    <!-- Labels -->
                    <text x="200" y="85" class="text small-text">Input</text>
                    <text x="380" y="75" class="text small-text">Parse</text>
                    <text x="470" y="45" class="text small-text">Yes</text>
                    <text x="470" y="145" class="text small-text">No</text>
                    <text x="520" y="40" class="text small-text">Skip</text>
                    <text x="575" y="250" class="text small-text">Execute</text>
                    <text x="550" y="340" class="text small-text">Results</text>
                    <text x="750" y="300" class="text small-text">Clean & Add</text>
                </svg>
            </div>

            <div class="flow-step">
                <div class="step-number">1</div>
                <div>User submits query which is analyzed for search-indicating keywords (temporal terms, information
                    requests, specific domains)</div>
            </div>
            <div class="flow-step">
                <div class="step-number">2</div>
                <div>If keywords found, immediate web search is triggered. If not, Small Language Model evaluates search
                    necessity</div>
            </div>
            <div class="flow-step">
                <div class="step-number">3</div>
                <div>Web search executes against configured engines, retrieving configurable number of results (default:
                    3)</div>
            </div>
            <div class="flow-step">
                <div class="step-number">4</div>
                <div>HTML markup is removed, clean text extracted, and results are integrated into LLM context</div>
            </div>
        </div>

        <div class="diagram-section">
            <h2 class="section-title">Strategy 2: Memory Search RAG Flow</h2>
            <div class="description">
                <p>This strategy provides semantic access to conversation history through vector embeddings, enabling
                    retrieval of relevant past interactions.</p>
            </div>

            <div class="svg-container">
                <svg viewBox="0 0 1000 700" style="width: 100%; height: auto;">
                    <!-- Query Input -->
                    <ellipse cx="100" cy="100" rx="80" ry="40" class="component" />
                    <text x="100" y="105" class="text">User Query</text>

                    <!-- Embedding Generation -->
                    <rect x="250" y="70" width="120" height="60" class="process" rx="10" />
                    <text x="310" y="95" class="text">Generate</text>
                    <text x="310" y="110" class="text">Embedding</text>

                    <!-- Vector Database -->
                    <rect x="50" y="250" width="150" height="120" class="database" rx="15" />
                    <text x="125" y="280" class="text" style="font-weight: bold;">Vector Database</text>
                    <text x="125" y="300" class="text small-text">• Message embeddings</text>
                    <text x="125" y="315" class="text small-text">• Summary embeddings</text>
                    <text x="125" y="330" class="text small-text">• Metadata</text>
                    <text x="125" y="345" class="text small-text">• Similarity indices</text>

                    <!-- Similarity Search -->
                    <rect x="250" y="200" width="120" height="80" class="highlight" rx="10" />
                    <text x="310" y="225" class="text">Similarity</text>
                    <text x="310" y="240" class="text">Search</text>
                    <text x="310" y="260" class="text small-text">Threshold: 0.7</text>

                    <!-- Threshold Filter -->
                    <polygon points="450,200 500,240 450,280 400,240" class="process" />
                    <text x="450" y="235" class="text small-text">Above</text>
                    <text x="450" y="250" class="text small-text">Threshold?</text>

                    <!-- Context Pairing Logic -->
                    <rect x="550" y="150" width="140" height="100" class="component" rx="10" />
                    <text x="620" y="175" class="text">Context Pairing</text>
                    <text x="620" y="195" class="text small-text">• User → Assistant</text>
                    <text x="620" y="210" class="text small-text">• Assistant → User</text>
                    <text x="620" y="225" class="text small-text">• Summary → Independent</text>

                    <!-- Memory Assembly -->
                    <rect x="550" y="300" width="140" height="80" class="process" rx="10" />
                    <text x="620" y="325" class="text">Memory</text>
                    <text x="620" y="340" class="text">Assembly</text>
                    <text x="620" y="360" class="text small-text">Fragments array</text>

                    <!-- Context Integration -->
                    <rect x="750" y="200" width="120" height="80" class="highlight" rx="10" />
                    <text x="810" y="225" class="text">Context</text>
                    <text x="810" y="240" class="text">Integration</text>
                    <text x="810" y="260" class="text small-text">Relevance order</text>

                    <!-- Historical Storage Process -->
                    <rect x="50" y="450" width="120" height="60" class="external" rx="10" />
                    <text x="110" y="475" class="text">Message</text>
                    <text x="110" y="490" class="text">Storage</text>

                    <rect x="200" y="450" width="120" height="60" class="process" rx="10" />
                    <text x="260" y="475" class="text">Embedding</text>
                    <text x="260" y="490" class="text">Generation</text>

                    <rect x="350" y="450" width="120" height="60" class="database" rx="10" />
                    <text x="410" y="475" class="text">Vector</text>
                    <text x="410" y="490" class="text">Storage</text>

                    <!-- Arrows -->
                    <line x1="180" y1="100" x2="240" y2="100" class="arrow" />
                    <line x1="310" y1="130" x2="310" y2="190" class="arrow" />
                    <line x1="200" y1="310" x2="240" y2="240" class="arrow" />
                    <line x1="370" y1="240" x2="390" y2="240" class="arrow" />
                    <line x1="500" y1="200" x2="540" y2="180" class="arrow" />
                    <line x1="500" y1="280" x2="540" y2="320" class="arrow" />
                    <line x1="620" y1="250" x2="620" y2="290" class="arrow" />
                    <line x1="690" y1="200" x2="740" y2="220" class="arrow" />
                    <line x1="690" y1="340" x2="740" y2="260" class="arrow" />

                    <!-- Historical process arrows -->
                    <line x1="170" y1="480" x2="190" y2="480" class="arrow" />
                    <line x1="320" y1="480" x2="340" y2="480" class="arrow" />
                    <line x1="410" y1="450" x2="150" y2="370" class="arrow" stroke-dasharray="5,5" />

                    <!-- Labels -->
                    <text x="200" y="85" class="text small-text">Embed</text>
                    <text x="280" y="170" class="text small-text">Query</text>
                    <text x="380" y="220" class="text small-text">Filter</text>
                    <text x="520" y="165" class="text small-text">Pass</text>
                    <text x="520" y="295" class="text small-text">Fail</text>
                    <text x="715" y="185" class="text small-text">Paired</text>
                    <text x="715" y="285" class="text small-text">Assembled</text>
                    <text x="180" y="535" class="text small-text">Historical Process</text>
                </svg>
            </div>

            <div class="flow-step">
                <div class="step-number">1</div>
                <div>Current user query is converted to vector embedding using dedicated embedding model</div>
            </div>
            <div class="flow-step">
                <div class="step-number">2</div>
                <div>Vector database is searched for semantically similar embeddings using configurable similarity
                    threshold (default: 0.7)</div>
            </div>
            <div class="flow-step">
                <div class="step-number">3</div>
                <div>Results above threshold are processed through context pairing logic: user messages paired with
                    assistant responses, summaries remain independent</div>
            </div>
            <div class="flow-step">
                <div class="step-number">4</div>
                <div>Retrieved memories are assembled into fragments and integrated into current context, ordered by
                    relevance</div>
            </div>
        </div>

        <div class="diagram-section">
            <h2 class="section-title">Strategy 3: In-Context Summarization Hierarchy</h2>
            <div class="description">
                <p>This strategy manages context window limitations through progressive summarization levels, creating a
                    hierarchical compression system that preserves essential information.</p>
            </div>

            <div class="svg-container">
                <svg viewBox="0 0 1200 900" style="width: 100%; height: auto;">
                    <!-- Message Flow -->
                    <rect x="50" y="50" width="60" height="30" class="component" rx="5" />
                    <text x="80" y="70" class="text small-text">M1</text>

                    <rect x="130" y="50" width="60" height="30" class="component" rx="5" />
                    <text x="160" y="70" class="text small-text">M2</text>

                    <rect x="210" y="50" width="60" height="30" class="component" rx="5" />
                    <text x="240" y="70" class="text small-text">M3</text>

                    <rect x="290" y="50" width="60" height="30" class="component" rx="5" />
                    <text x="320" y="70" class="text small-text">M4</text>

                    <rect x="370" y="50" width="60" height="30" class="component" rx="5" />
                    <text x="400" y="70" class="text small-text">M5</text>

                    <rect x="450" y="50" width="60" height="30" class="component" rx="5" />
                    <text x="480" y="70" class="text small-text">M6</text>

                    <!-- Trigger Point -->
                    <text x="550" y="70" class="text" style="fill: #e74c3c;">n_sum = 6 reached!</text>

                    <!-- Level 1 Summarization -->
                    <rect x="50" y="150" width="180" height="40" class="process" rx="10" />
                    <text x="140" y="175" class="text">Level 1 Summary (M4+M5+M6)</text>

                    <rect x="50" y="220" width="60" height="30" class="component" rx="5" />
                    <text x="80" y="240" class="text small-text">M1</text>

                    <rect x="130" y="220" width="60" height="30" class="component" rx="5" />
                    <text x="160" y="240" class="text small-text">M2</text>

                    <rect x="210" y="220" width="60" height="30" class="component" rx="5" />
                    <text x="240" y="240" class="text small-text">M3</text>

                    <rect x="290" y="220" width="80" height="30" class="database" rx="5" />
                    <text x="330" y="240" class="text small-text">S1-L1</text>

                    <!-- More messages -->
                    <rect x="390" y="220" width="60" height="30" class="component" rx="5" />
                    <text x="420" y="240" class="text small-text">M7</text>

                    <rect x="470" y="220" width="60" height="30" class="component" rx="5" />
                    <text x="500" y="240" class="text small-text">M8</text>

                    <rect x="550" y="220" width="60" height="30" class="component" rx="5" />
                    <text x="580" y="240" class="text small-text">M9</text>

                    <!-- Second Level 1 Summary -->
                    <rect x="650" y="220" width="80" height="30" class="database" rx="5" />
                    <text x="690" y="240" class="text small-text">S2-L1</text>

                    <rect x="750" y="220" width="80" height="30" class="database" rx="5" />
                    <text x="790" y="240" class="text small-text">S3-L1</text>

                    <!-- Level 2 Trigger -->
                    <text x="860" y="240" class="text" style="fill: #e74c3c;">n_sum_sum = 3 reached!</text>

                    <!-- Level 2 Summarization -->
                    <rect x="650" y="320" width="180" height="40" class="highlight" rx="10" />
                    <text x="740" y="345" class="text">Level 2 Summary (S1+S2+S3)</text>

                    <rect x="50" y="390" width="60" height="30" class="component" rx="5" />
                    <text x="80" y="410" class="text small-text">M1</text>

                    <rect x="130" y="390" width="60" height="30" class="component" rx="5" />
                    <text x="160" y="410" class="text small-text">M2</text>

                    <rect x="210" y="390" width="60" height="30" class="component" rx="5" />
                    <text x="240" y="410" class="text small-text">M3</text>

                    <rect x="290" y="390" width="80" height="30" class="external" rx="5" />
                    <text x="330" y="410" class="text small-text">S1-L2</text>

                    <!-- Level 3 and Master Summary Process -->
                    <rect x="500" y="500" width="200" height="60" class="highlight" rx="15" />
                    <text x="600" y="525" class="text" style="font-weight: bold;">Level 3 Summary</text>
                    <text x="600" y="545" class="text small-text">max_sum_lvl reached</text>

                    <rect x="750" y="500" width="200" height="60" class="database" rx="15" />
                    <text x="850" y="525" class="text" style="font-weight: bold;">Master Summary</text>
                    <text x="850" y="545" class="text small-text">Ultimate compression</text>

                    <!-- Configuration Panel -->
                    <rect x="50" y="650" width="400" height="200" class="component" rx="15"
                        fill="url(#diagonalHatch)" />
                    <text x="250" y="680" class="text" style="font-weight: bold;">Configuration Parameters</text>
                    <text x="70" y="710" class="text small-text">n_sum = 6 (messages before summarization)</text>
                    <text x="70" y="730" class="text small-text">sum_window = 3 (messages in each summary)</text>
                    <text x="70" y="750" class="text small-text">n_sum_sum = 3 (summaries before next level)</text>
                    <text x="70" y="770" class="text small-text">max_sum_lvl = 3 (maximum hierarchy level)</text>
                    <text x="70" y="800" class="text small-text">summary_model = SLM/LLM for summarization</text>
                    <text x="70" y="820" class="text small-text">summary_length = Target token count</text>

                    <!-- Storage and Embedding Process -->
                    <rect x="500" y="650" width="150" height="80" class="database" rx="10" />
                    <text x="575" y="675" class="text">Summary Storage</text>
                    <text x="575" y="695" class="text small-text">• Database record</text>
                    <text x="575" y="710" class="text small-text">• Source IDs tracked</text>
                    <text x="575" y="720" class="text small-text">• Level metadata</text>

                    <rect x="680" y="650" width="150" height="80" class="highlight" rx="10" />
                    <text x="755" y="675" class="text">Vector Storage</text>
                    <text x="755" y="695" class="text small-text">• Embedding created</text>
                    <text x="755" y="710" class="text small-text">• Added to memory</text>
                    <text x="755" y="720" class="text small-text">• Searchable</text>

                    <!-- Arrows showing summarization flow -->
                    <line x1="140" y1="80" x2="140" y2="140" class="arrow" />
                    <line x1="740" y1="250" x2="740" y2="310" class="arrow" />
                    <line x1="600" y1="560" x2="750" y2="530" class="arrow" />
                    <line x1="740" y1="360" x2="575" y2="480" class="arrow" />

                    <!-- Storage process arrows -->
                    <line x1="600" y1="560" x2="575" y2="640" class="arrow" />
                    <line x1="650" y1="690" x2="670" y2="690" class="arrow" />

                    <!-- Labels -->
                    <text x="50" y="30" class="text small-text">Original Messages</text>
                    <text x="50" y="200" class="text small-text">After L1 Summary</text>
                    <text x="50" y="370" class="text small-text">After L2 Summary</text>
                    <text x="580" y="630" class="text small-text">Storage Process</text>
                </svg>
            </div>

            <div class="flow-step">
                <div class="step-number">1</div>
                <div><strong>Level 1 Trigger:</strong> When n_sum messages (default: 6) accumulate, the last sum_window
                    messages (default: 3) are summarized into a Level 1 summary</div>
            </div>
            <div class="flow-step">
                <div class="step-number">2</div>
                <div><strong>Higher Level Summarization:</strong> When n_sum_sum summaries (default: 3) of the same
                    level exist, they are combined into the next level summary</div>
            </div>
            <div class="flow-step">
                <div class="step-number">3</div>
                <div><strong>Master Summary Creation:</strong> At max_sum_lvl (default: 3), summaries are consolidated
                    into a master summary that gets updated rather than replaced</div>
            </div>
            <div class="flow-step">
                <div class="step-number">4</div>
                <div><strong>Storage and Indexing:</strong> Each summary is stored with source IDs, converted to
                    embeddings, and added to the vector database for future retrieval</div>
            </div>
        </div>

        <div class="diagram-section">
            <h2 class="section-title">Unified Data Flow and Integration</h2>
            <div class="description">
                <p>This diagram illustrates how all three strategies integrate their outputs into a unified context that
                    maximizes the LLM's response quality while respecting token limits.</p>
            </div>

            <div class="svg-container">
                <svg viewBox="0 0 1000 800" style="width: 100%; height: auto;">
                    <!-- Input Sources -->
                    <rect x="50" y="50" width="120" height="60" class="external" rx="10" />
                    <text x="110" y="75" class="text">External</text>
                    <text x="110" y="90" class="text">Search Results</text>

                    <rect x="50" y="150" width="120" height="60" class="highlight" rx="10" />
                    <text x="110" y="175" class="text">Memory</text>
                    <text x="110" y="190" class="text">Search Results</text>

                    <rect x="50" y="250" width="120" height="60" class="database" rx="10" />
                    <text x="110" y="275" class="text">Hierarchical</text>
                    <text x="110" y="290" class="text">Summaries</text>

                    <rect x="50" y="350" width="120" height="60" class="component" rx="10" />
                    <text x="110" y="375" class="text">Current</text>
                    <text x="110" y="390" class="text">Conversation</text>

                    <!-- Priority Ordering -->
                    <rect x="250" y="150" width="150" height="120" class="process" rx="15" />
                    <text x="325" y="180" class="text" style="font-weight: bold;">Priority Ordering</text>
                    <text x="325" y="205" class="text small-text">1. External results</text>
                    <text x="325" y="220" class="text small-text">2. Memory fragments</text>
                    <text x="325" y="235" class="text small-text">3. Recent summaries</text>
                    <text x="325" y="250" class="text small-text">4. Current context</text>

                    <!-- Token Management -->
                    <rect x="450" y="100" width="150" height="80" class="highlight" rx="10" />
                    <text x="525" y="125" class="text">Token</text>
                    <text x="525" y="140" class="text">Management</text>
                    <text x="525" y="165" class="text small-text">Dynamic allocation</text>

                    <!-- Context Assembly -->
                    <rect x="450" y="200" width="150" height="100" class="process" rx="10" />
                    <text x="525" y="225" class="text" style="font-weight: bold;">Context Assembly</text>
                    <text x="525" y="245" class="text small-text">• Relevance scoring</text>
                    <text x="525" y="260" class="text small-text">• Token optimization</text>
                    <text x="525" y="275" class="text small-text">• Overflow handling</text>
                    <text x="525" y="290" class="text small-text">• Format consistency</text>

                    <!-- Quality Assurance -->
                    <rect x="650" y="150" width="120" height="80" class="component" rx="10" />
                    <text x="710" y="175" class="text">Quality</text>
                    <text x="710" y="190" class="text">Assurance</text>
                    <text x="710" y="210" class="text small-text">• Coherence check</text>
                    <text x="710" y="220" class="text small-text">• Relevance filter</text>

                    <!-- Final Context -->
                    <rect x="450" y="350" width="200" height="100" class="highlight" rx="15" />
                    <text x="550" y="380" class="text" style="font-weight: bold;">Enhanced Context</text>
                    <text x="550" y="405" class="text small-text">• External knowledge</text>
                    <text x="550" y="420" class="text small-text">• Historical relevance</text>
                    <text x="550" y="435" class="text small-text">• Compressed summaries</text>

                    <!-- LLM Processing -->
                    <rect x="750" y="300" width="150" height="120" class="external" rx="15" />
                    <text x="825" y="335" class="text" style="font-weight: bold;">Large Language</text>
                    <text x="825" y="355" class="text" style="font-weight: bold;">Model</text>
                    <text x="825" y="380" class="text small-text">Extended context</text>
                    <text x="825" y="395" class="text small-text">Enhanced reasoning</text>
                    <text x="825" y="410" class="text small-text">Informed responses</text>

                    <!-- Performance Monitoring -->
                    <rect x="250" y="500" width="200" height="120" class="component" rx="15" />
                    <text x="350" y="530" class="text" style="font-weight: bold;">Performance Monitoring</text>
                    <text x="350" y="555" class="text small-text">• Retrieval latency</text>
                    <text x="350" y="570" class="text small-text">• Context utilization</text>
                    <text x="350" y="585" class="text small-text">• Summary quality scores</text>
                    <text x="350" y="600" class="text small-text">• User satisfaction metrics</text>

                    <!-- Feedback Loop -->
                    <rect x="500" y="500" width="200" height="120" class="database" rx="15" />
                    <text x="600" y="530" class="text" style="font-weight: bold;">Continuous Learning</text>
                    <text x="600" y="555" class="text small-text">• Usage pattern analysis</text>
                    <text x="600" y="570" class="text small-text">• Model improvement</text>
                    <text x="600" y="585" class="text small-text">• Parameter tuning</text>
                    <text x="600" y="600" class="text small-text">• Error correction</text>

                    <!-- Arrows -->
                    <line x1="170" y1="80" x2="240" y2="160" class="arrow" />
                    <line x1="170" y1="180" x2="240" y2="200" class="arrow" />
                    <line x1="170" y1="280" x2="240" y2="240" class="arrow" />
                    <line x1="170" y1="380" x2="240" y2="260" class="arrow" />

                    <line x1="400" y1="210" x2="440" y2="140" class="arrow" />
                    <line x1="400" y1="210" x2="440" y2="250" class="arrow" />

                    <line x1="600" y1="250" x2="640" y2="190" class="arrow" />
                    <line x1="600" y1="300" x2="550" y2="340" class="arrow" />

                    <line x1="650" y1="400" x2="740" y2="360" class="arrow" />

                    <line x1="550" y1="450" x2="350" y2="490" class="arrow" />
                    <line x1="450" y1="560" x2="490" y2="560" class="arrow" />
                    <line x1="600" y1="500" x2="525" y2="300" class="arrow" stroke-dasharray="5,5" />

                    <!-- Labels -->
                    <text x="200" y="120" class="text small-text">Input</text>
                    <text x="200" y="140" class="text small-text">Sources</text>
                    <text x="420" y="185" class="text small-text">Prioritize</text>
                    <text x="610" y="175" class="text small-text">Validate</text>
                    <text x="680" y="330" class="text small-text">Process</text>
                    <text x="400" y="470" class="text small-text">Monitor</text>
                    <text x="550" y="470" class="text small-text">Feedback</text>
                </svg>
            </div>

            <div class="flow-step">
                <div class="step-number">1</div>
                <div><strong>Input Aggregation:</strong> All three strategies contribute their results - external search
                    results, relevant memories, hierarchical summaries, and current conversation context</div>
            </div>
            <div class="flow-step">
                <div class="step-number">2</div>
                <div><strong>Priority-Based Integration:</strong> Content is ordered by relevance and recency, with
                    external results taking highest priority, followed by semantic memories and compressed summaries
                </div>
            </div>
            <div class="flow-step">
                <div class="step-number">3</div>
                <div><strong>Token Optimization:</strong> Dynamic allocation ensures optimal use of available context
                    window, with intelligent overflow handling when limits are approached</div>
            </div>
            <div class="flow-step">
                <div class="step-number">4</div>
                <div><strong>Quality Assurance:</strong> Final context undergoes coherence checking and relevance
                    filtering before being passed to the LLM for enhanced response generation</div>
            </div>
            <div class="flow-step">
                <div class="step-number">5</div>
                <div><strong>Continuous Improvement:</strong> Performance metrics and user feedback drive ongoing
                    optimization of retrieval algorithms, summarization quality, and context assembly strategies</div>
            </div>
        </div>
    </div>
</body>

</html>