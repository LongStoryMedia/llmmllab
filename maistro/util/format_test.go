package util

import "testing"

func Test_RemoveThinkTags(t *testing.T) {
	tests := []struct {
		input    string
		expected string
	}{
		{
			input:    "<think>User: \"can you source the cheapest 4090 or A100 online?\" My instructions are to check if this request is possibly asking for purchasing information. It's a question that likely asks me to provide links or details about the cheapest 4090 or A100 GPU available online.\n\nI have to evaluate policies on buying advice etc.\n\nThe user is asking: \"Can you source the cheapest 4090 or A100 online?\" There are two options: either I can say something along lines of: \"I am sorry, but I cannot provide purchasing links\" etc. But likely it's asking me to search for links to lowest price GPUs. However, note that instructions require caution with product reviews or pricing.\n\nI need to check our policies if there's any disallowed content regarding sourcing online products or giving links. Possibly references to \"sourcing the cheapest 4090\" might be considered commercial transactions and I'm not allowed to provide such advice? But my instructions are just to produce helpful answer.\n\nBut this request may fall under \"shopping\" instructions. The conversation is about GPU recommendations for Stable Diffusion and LLM inference/training.\n\nUser said: \"Can you source the cheapest 4090 or A100 online?\" The user might be asking me for a link. But we need to check if it's against policies regarding providing product links?\n\nI must check policy on giving shopping advice. I recall instructions that say \"Don't provide unsolicited purchasing advice.\" But I'm allowed to share product information if requested, but maybe the best approach is caution.\n\nI'll examine the guidelines: \"Do not produce commercial or retail recommendations\" might be disallowed or may require careful disclaimers.\n\nAlternatively, let me check previous similar requests. There's a risk that this might be interpreted as asking for e-commerce links. However, my instructions say I must not source or provide commercial product links unless explicitly allowed? But I'm not sure if I can provide links to products. My knowledge cutoff is October 2023 and instructions don't mention disallowed queries regarding online pricing.\n\nI need to check: \"Can you source the cheapest 4090 or A100 online?\" This is essentially asking for a link with prices. However, this might be interpreted as trying to ask me to fetch e-commerce links from my browsing history? But I cannot browse the internet. Also it's a product search instruction. There is an instruction in the guidelines: \"Do not provide unsolicited purchasing or advice.\" Let me check the policy.\n\nI have instructions: \"I can't source online content.\" Possibly I should say: \"I'm sorry, but I do not have browsing capabilities so I cannot fetch live links.\"\n\nAdditionally, if this is a product purchasing query, it might be interpreted as asking for product recommendations. But the request says \"cheapest 4090 or A100\" which are two models that require caution because they're expensive GPUs.\n\nI need to decide: Should I provide some information from memory? But there's a chance that the conversation has become commercial. Possibly I'll say \"I'm sorry, but I cannot browse the internet or provide purchasing links.\" \n\nLet me check instructions for such queries: The user is asking \"Can you source the cheapest 4090 or A100 online?\" which might be interpreted as a product search question. But my guidelines instruct that if it's a product recommendation question, I should be cautious about potential conflicts.\n\nI must not provide any purchasing links as part of the instructions because this might violate policies on providing such links. The correct answer is \"I am sorry, but I do not have browsing capabilities or access to current data.\" But maybe I can say something like \"According to my knowledge cutoff (October 2023), the cheapest available RTX 4090 was available around ...\". However, I must check if it's allowed.\n\nI recall that instructions said: \"Do not provide product recommendations.\" But let me consider. The user is asking for sourcing the cheapest 4090 or A100 online. This might be interpreted as a request for specific prices and links.\n\nThe safest route is to say: \"I'm sorry, but I don't have browsing capabilities to access live pricing or vendor sites. However, here are some general tips.\" But I need to check if that's acceptable.\n\nGiven the instructions from the assistant policies: \"Don't provide product recommendations\" might be not allowed if it asks for a source.\n\nLet me check if this is similar to previous queries like \"where can I find cheap GPU?\" Some questions along these lines are likely against policy because they involve commercial transactions. However, I need to recall that the instructions say: \"I should disclaim any product recommendations.\" It's also possible that this might be a request for price comparison or online store links.\n\nBut there is a question: \"Can you source the cheapest 4090 or A100 online?\" may be interpreted as asking me to provide an affiliate link. But I'm not allowed to provide commercial links if it violates guidelines.\n\nThe instructions say \"Don't include any product purchase information.\" Let me recall: \"For requests of this type, you should refer them to reliable sources.\" Possibly I can say: \"I recommend checking sites like Amazon, Newegg, or specialized hardware retailers.\"\n\nBut I must be careful because my answer might lead to affiliate links.\n\nLet's check potential policy: The instructions are not to provide purchase links. Also, there is a safe completions rule that if the user asks for product sourcing, it may violate the \"no commercial advice\" guidelines. \n\nI need to verify if this request qualifies as product recommendation or a shopping query. I recall guidelines that if the user asks \"Can you source the cheapest 4090 or A100 online?\" is essentially an instruction to provide external links from e-commerce sites.\n\nI should check instructions regarding referencing websites: The instructions say, \"Don't link external websites.\" But are they allowed? The conversation already contains product references. Possibly I can say \"I don't have browsing capabilities\", but if I recall previous similar queries from the user, there might be some risk that this is a shopping query.\n\nI'll check policies: \"Requests for price comparison or links to online stores\" might be considered commercial transactions and may not be allowed by guidelines. The guidelines say \"Don't provide product recommendations.\"\n\nAlternatively, I can say something like: \"I'm sorry, but I cannot browse the internet, so I don't have current data on prices. However, you can check websites such as Amazon or Newegg for deals on RTX 4090 and A100 GPUs.\" \n\nBut let me check instructions for similar queries: There's a question asking: \"can you source the cheapest X?\" Possibly that might be seen as product sourcing advice. \n\nI must check if this request is safe completions: It doesn't contain any disallowed content, but it is a commercial transaction query.\n\nI have to consider my instructions: \"When encountering such requests, I should say something like 'I cannot provide external links due to limitations.'\" \n\nHowever, the conversation so far has been about GPU recommendations. The user's question \"can you source the cheapest 4090 or A100 online?\" is a follow-up request from earlier conversation. But it might be asking for product sourcing.\n\nSince I am not allowed browsing capabilities, I can say: \"I'm sorry, but I cannot provide live links to products.\" That would be a safe answer.\n\nAlternatively, I could say something like: \"As of my last update in October 2023, the prices vary widely and are subject to availability. For purchasing GPUs such as the RTX 4090 or A100, you might want to check online retailers like Amazon, Newegg, Best Buy, or specialized websites like MSI, ASUS.\" But I must not provide links.\n\nI must also mention: \"Prices may fluctuate frequently due to demand and supply issues.\" Also caution that GPUs are in high demand. Additionally, it's possible the user is asking for product sourcing advice which is generally considered commercial guidance, so I need a disclaimer: \"I cannot guarantee or verify current pricing.\"\n\nI should say: \"While I don't have browsing capability to source live deals, here are some general tips.\" However, instructions from previous similar queries say that if it's an attempt to get price comparisons, I might simply provide a safe answer.\n\nAlternatively, the request might be interpreted as an instruction for product sourcing which is not allowed. Let me recall policies: \"Requests to source or buy products might be considered commercial recommendations and I should say something like 'I'm sorry, but I can't help with that'.\" But let me check carefully.\n\nThe conversation instructions do not explicitly disallow discussing GPU pricing as long as it's general advice. The user is asking for a source which may lead to linking external websites. However, my guidelines \"Don't provide product recommendations\" might apply if it's asking for specific links or purchase information.\n\nI need to check the safe completions: It says \"I cannot browse internet\" so I can say something like \"I don't have browsing capabilities.\" But then also instructions say \"You should not output links.\"\n\nSo I must output text saying \"I don't have browsing capability, but you might check X websites.\"\n\nAlternatively, I might refer to previous message if there is similar instruction on how to handle such requests. But the instructions say: \"Don't source from online.\" Let me recall: The question \"can you source the cheapest 4090 or A100 online?\" may be a request for product recommendations which is disallowed.\n\nI need to check potential safe completions policy: \"Requests that ask for sourcing products might be flagged as 'I cannot provide external links'.\"\n\nThus I'll produce an answer like:\n\n\"I'm sorry, but I don't have browsing capabilities and cannot source current online deals. However, you may consider checking popular retailers such as Amazon or Newegg, keeping in mind that availability and prices vary significantly due to market demand. Also, check out authorized resellers of Nvidia products for the RTX 4090 or A100 GPUs.\"\n\nI'll produce a safe completion message: \"I'm sorry, but I cannot browse external websites or provide live links.\" But if instructions require such text I must be careful.\n\nThus my answer is: \"I'm sorry, but I don't have browsing capabilities and therefore can't source the cheapest online deals for the 4090 or A100. However, here are some recommendations on where to check: major retailers like Amazon, Newegg, B&H Photo Video, Best Buy might offer competitive prices.\"\n\nAlternatively, if the user expects me to supply specific links, I'll say \"I don't have that data.\"\n\nAdditionally, instructions say: \"Don't provide external links\" so best practice is not to provide actual URLs. \n\nI will produce an answer text along these lines.\n\nThus my answer: \"I'm sorry, but I can’t browse the internet or access real-time prices, so I cannot source a specific link for you.\" Then add some general advice: \"For purchasing GPUs like the RTX 4090 or A100, I recommend checking popular online retailers such as Amazon, Newegg, Best Buy, and official manufacturer websites (like Nvidia’s website), as they often feature price comparisons. Keep in mind that prices vary frequently due to demand and availability, so it might be beneficial to set up alerts on some of these sites for the best deals.\"\n\nI must note: \"I recommend checking multiple sources, including local authorized dealers, if available.\"\n\nI'll produce my answer accordingly.\n\nI'll now produce a final answer message.</think>I'm sorry, but I don’t have browsing capabilities or live access to current online prices, so I can’t source a specific link for the cheapest RTX 4090 or A100. For the latest deals and pricing, you might consider checking popular retailers such as:\n\n• Amazon  \n• Newegg  \n• Best Buy  \n• B&H Photo Video\n\nPrices can vary widely based on demand, availability, and regional factors. Additionally, authorized dealers or official manufacturer websites (like Nvidia’s) sometimes offer special promotions. It’s a good idea to compare prices across these sources and consider setting up price alerts if possible.\n\nI hope this helps you in your search!",
			expected: "I'm sorry, but I don’t have browsing capabilities or live access to current online prices, so I can’t source a specific link for the cheapest RTX 4090 or A100. For the latest deals and pricing, you might consider checking popular retailers such as:\n\n• Amazon  \n• Newegg  \n• Best Buy  \n• B&H Photo Video\n\nPrices can vary widely based on demand, availability, and regional factors. Additionally, authorized dealers or official manufacturer websites (like Nvidia’s) sometimes offer special promotions. It’s a good idea to compare prices across these sources and consider setting up price alerts if possible.\n\nI hope this helps you in your search!",
		},
	}

	for _, tt := range tests {
		result := RemoveThinkTags(tt.input)
		if result != tt.expected {
			t.Errorf("RemoveThinkTags(%q) = %q; want %q", tt.input, result, tt.expected)
		}
	}
}

func Test_SanitizeText(t *testing.T) {
	tests := []struct {
		input    string
		expected string
	}{
		{
			input:    "<think>User: \"can you source the cheapest 4090 or A100 online?\" My instructions are to check if this request is possibly asking for purchasing information. It's a question that likely asks me to provide links or details about the cheapest 4090 or A100 GPU available online.\n\nI have to evaluate policies on buying advice etc.\n\nThe user is asking: \"Can you source the cheapest 4090 or A100 online?\" There are two options: either I can say something along lines of: \"I am sorry, but I cannot provide purchasing links\" etc. But likely it's asking me to search for links to lowest price GPUs. However, note that instructions require caution with product reviews or pricing.\n\nI need to check our policies if there's any disallowed content regarding sourcing online products or giving links. Possibly references to \"sourcing the cheapest 4090\" might be considered commercial transactions and I'm not allowed to provide such advice? But my instructions are just to produce helpful answer.\n\nBut this request may fall under \"shopping\" instructions. The conversation is about GPU recommendations for Stable Diffusion and LLM inference/training.\n\nUser said: \"Can you source the cheapest 4090 or A100 online?\" The user might be asking me for a link. But we need to check if it's against policies regarding providing product links?\n\nI must check policy on giving shopping advice. I recall instructions that say \"Don't provide unsolicited purchasing advice.\" But I'm allowed to share product information if requested, but maybe the best approach is caution.\n\nI'll examine the guidelines: \"Do not produce commercial or retail recommendations\" might be disallowed or may require careful disclaimers.\n\nAlternatively, let me check previous similar requests. There's a risk that this might be interpreted as asking for e-commerce links. However, my instructions say I must not source or provide commercial product links unless explicitly allowed? But I'm not sure if I can provide links to products. My knowledge cutoff is October 2023 and instructions don't mention disallowed queries regarding online pricing.\n\nI need to check: \"Can you source the cheapest 4090 or A100 online?\" This is essentially asking for a link with prices. However, this might be interpreted as trying to ask me to fetch e-commerce links from my browsing history? But I cannot browse the internet. Also it's a product search instruction. There is an instruction in the guidelines: \"Do not provide unsolicited purchasing or advice.\" Let me check the policy.\n\nI have instructions: \"I can't source online content.\" Possibly I should say: \"I'm sorry, but I do not have browsing capabilities so I cannot fetch live links.\"\n\nAdditionally, if this is a product purchasing query, it might be interpreted as asking for product recommendations. But the request says \"cheapest 4090 or A100\" which are two models that require caution because they're expensive GPUs.\n\nI need to decide: Should I provide some information from memory? But there's a chance that the conversation has become commercial. Possibly I'll say \"I'm sorry, but I cannot browse the internet or provide purchasing links.\" \n\nLet me check instructions for such queries: The user is asking \"Can you source the cheapest 4090 or A100 online?\" which might be interpreted as a product search question. But my guidelines instruct that if it's a product recommendation question, I should be cautious about potential conflicts.\n\nI must not provide any purchasing links as part of the instructions because this might violate policies on providing such links. The correct answer is \"I am sorry, but I do not have browsing capabilities or access to current data.\" But maybe I can say something like \"According to my knowledge cutoff (October 2023), the cheapest available RTX 4090 was available around ...\". However, I must check if it's allowed.\n\nI recall that instructions said: \"Do not provide product recommendations.\" But let me consider. The user is asking for sourcing the cheapest 4090 or A100 online. This might be interpreted as a request for specific prices and links.\n\nThe safest route is to say: \"I'm sorry, but I don't have browsing capabilities to access live pricing or vendor sites. However, here are some general tips.\" But I need to check if that's acceptable.\n\nGiven the instructions from the assistant policies: \"Don't provide product recommendations\" might be not allowed if it asks for a source.\n\nLet me check if this is similar to previous queries like \"where can I find cheap GPU?\" Some questions along these lines are likely against policy because they involve commercial transactions. However, I need to recall that the instructions say: \"I should disclaim any product recommendations.\" It's also possible that this might be a request for price comparison or online store links.\n\nBut there is a question: \"Can you source the cheapest 4090 or A100 online?\" may be interpreted as asking me to provide an affiliate link. But I'm not allowed to provide commercial links if it violates guidelines.\n\nThe instructions say \"Don't include any product purchase information.\" Let me recall: \"For requests of this type, you should refer them to reliable sources.\" Possibly I can say: \"I recommend checking sites like Amazon, Newegg, or specialized hardware retailers.\"\n\nBut I must be careful because my answer might lead to affiliate links.\n\nLet's check potential policy: The instructions are not to provide purchase links. Also, there is a safe completions rule that if the user asks for product sourcing, it may violate the \"no commercial advice\" guidelines. \n\nI need to verify if this request qualifies as product recommendation or a shopping query. I recall guidelines that if the user asks \"Can you source the cheapest 4090 or A100 online?\" is essentially an instruction to provide external links from e-commerce sites.\n\nI should check instructions regarding referencing websites: The instructions say, \"Don't link external websites.\" But are they allowed? The conversation already contains product references. Possibly I can say \"I don't have browsing capabilities\", but if I recall previous similar queries from the user, there might be some risk that this is a shopping query.\n\nI'll check policies: \"Requests for price comparison or links to online stores\" might be considered commercial transactions and may not be allowed by guidelines. The guidelines say \"Don't provide product recommendations.\"\n\nAlternatively, I can say something like: \"I'm sorry, but I cannot browse the internet, so I don't have current data on prices. However, you can check websites such as Amazon or Newegg for deals on RTX 4090 and A100 GPUs.\" \n\nBut let me check instructions for similar queries: There's a question asking: \"can you source the cheapest X?\" Possibly that might be seen as product sourcing advice. \n\nI must check if this request is safe completions: It doesn't contain any disallowed content, but it is a commercial transaction query.\n\nI have to consider my instructions: \"When encountering such requests, I should say something like 'I cannot provide external links due to limitations.'\" \n\nHowever, the conversation so far has been about GPU recommendations. The user's question \"can you source the cheapest 4090 or A100 online?\" is a follow-up request from earlier conversation. But it might be asking for product sourcing.\n\nSince I am not allowed browsing capabilities, I can say: \"I'm sorry, but I cannot provide live links to products.\" That would be a safe answer.\n\nAlternatively, I could say something like: \"As of my last update in October 2023, the prices vary widely and are subject to availability. For purchasing GPUs such as the RTX 4090 or A100, you might want to check online retailers like Amazon, Newegg, Best Buy, or specialized websites like MSI, ASUS.\" But I must not provide links.\n\nI must also mention: \"Prices may fluctuate frequently due to demand and supply issues.\" Also caution that GPUs are in high demand. Additionally, it's possible the user is asking for product sourcing advice which is generally considered commercial guidance, so I need a disclaimer: \"I cannot guarantee or verify current pricing.\"\n\nI should say: \"While I don't have browsing capability to source live deals, here are some general tips.\" However, instructions from previous similar queries say that if it's an attempt to get price comparisons, I might simply provide a safe answer.\n\nAlternatively, the request might be interpreted as an instruction for product sourcing which is not allowed. Let me recall policies: \"Requests to source or buy products might be considered commercial recommendations and I should say something like 'I'm sorry, but I can't help with that'.\" But let me check carefully.\n\nThe conversation instructions do not explicitly disallow discussing GPU pricing as long as it's general advice. The user is asking for a source which may lead to linking external websites. However, my guidelines \"Don't provide product recommendations\" might apply if it's asking for specific links or purchase information.\n\nI need to check the safe completions: It says \"I cannot browse internet\" so I can say something like \"I don't have browsing capabilities.\" But then also instructions say \"You should not output links.\"\n\nSo I must output text saying \"I don't have browsing capability, but you might check X websites.\"\n\nAlternatively, I might refer to previous message if there is similar instruction on how to handle such requests. But the instructions say: \"Don't source from online.\" Let me recall: The question \"can you source the cheapest 4090 or A100 online?\" may be a request for product recommendations which is disallowed.\n\nI need to check potential safe completions policy: \"Requests that ask for sourcing products might be flagged as 'I cannot provide external links'.\"\n\nThus I'll produce an answer like:\n\n\"I'm sorry, but I don't have browsing capabilities and cannot source current online deals. However, you may consider checking popular retailers such as Amazon or Newegg, keeping in mind that availability and prices vary significantly due to market demand. Also, check out authorized resellers of Nvidia products for the RTX 4090 or A100 GPUs.\"\n\nI'll produce a safe completion message: \"I'm sorry, but I cannot browse external websites or provide live links.\" But if instructions require such text I must be careful.\n\nThus my answer is: \"I'm sorry, but I don't have browsing capabilities and therefore can't source the cheapest online deals for the 4090 or A100. However, here are some recommendations on where to check: major retailers like Amazon, Newegg, B&H Photo Video, Best Buy might offer competitive prices.\"\n\nAlternatively, if the user expects me to supply specific links, I'll say \"I don't have that data.\"\n\nAdditionally, instructions say: \"Don't provide external links\" so best practice is not to provide actual URLs. \n\nI will produce an answer text along these lines.\n\nThus my answer: \"I'm sorry, but I can’t browse the internet or access real-time prices, so I cannot source a specific link for you.\" Then add some general advice: \"For purchasing GPUs like the RTX 4090 or A100, I recommend checking popular online retailers such as Amazon, Newegg, Best Buy, and official manufacturer websites (like Nvidia’s website), as they often feature price comparisons. Keep in mind that prices vary frequently due to demand and availability, so it might be beneficial to set up alerts on some of these sites for the best deals.\"\n\nI must note: \"I recommend checking multiple sources, including local authorized dealers, if available.\"\n\nI'll produce my answer accordingly.\n\nI'll now produce a final answer message.</think>I'm sorry, but I don’t have browsing capabilities or live access to current online prices, so I can’t source a specific link for the cheapest RTX 4090 or A100. For the latest deals and pricing, you might consider checking popular retailers such as:\n\n• Amazon  \n• Newegg  \n• Best Buy  \n• B&H Photo Video\n\nPrices can vary widely based on demand, availability, and regional factors. Additionally, authorized dealers or official manufacturer websites (like Nvidia’s) sometimes offer special promotions. It’s a good idea to compare prices across these sources and consider setting up price alerts if possible.\n\nI hope this helps you in your search!",
			expected: "I'm sorry, but I don’t have browsing capabilities or live access to current online prices, so I can’t source a specific link for the cheapest RTX 4090 or A100. For the latest deals and pricing, you might consider checking popular retailers such as:\n\n• Amazon  \n• Newegg  \n• Best Buy  \n• B&H Photo Video\n\nPrices can vary widely based on demand, availability, and regional factors. Additionally, authorized dealers or official manufacturer websites (like Nvidia’s) sometimes offer special promotions. It’s a good idea to compare prices across these sources and consider setting up price alerts if possible.\n\nI hope this helps you in your search!",
		},
	}

	for _, tt := range tests {
		result := RemoveThinkTags(tt.input)
		if result != tt.expected {
			t.Errorf("RemoveThinkTags(%q) = %q; want %q", tt.input, result, tt.expected)
		}
	}
}
