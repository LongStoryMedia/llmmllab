package context

import (
	"context"
	"maistro/config"
	"maistro/test"
	"testing"
)

var query = "what is the problem here??\n\n```sql\n-- Search for semantically similar content across all conversations\n-- Parameters:\n-- $1: embedding vector\n-- $2: minimum similarity threshold\n-- $3: limit of results\nDEALLOCATE myquery;\nPREPARE myquery AS \nWITH unified_results AS (\n  -- Find similar messages\n  SELECT\n    m.id,\n    m.role,\n    m.content,\n    m.conversation_id,\n    1 -(e.embedding <=> $1) AS similarity,\n    'message' AS source_type\n  FROM\n    memories e\n    JOIN messages m ON e.source_id = m.id\n  WHERE\n    1 -(e.embedding <=> $1) > $2\n    AND e.source = 'message'\n  UNION ALL\n  -- Find similar summaries\n  SELECT\n    s.id,\n    'system' AS role,\n    s.content,\n    s.conversation_id,\n    1 -(e.embedding <=> $1) AS similarity,\n    'summary' AS source_type\n  FROM\n    memories e\n    JOIN summaries s ON e.source_id = s.id\n  WHERE\n    1 -(e.embedding <=> $1) > $2\n    AND e.source = 'summary'\n  -- UNION ALL\n  -- -- Find similar research results\n  -- SELECT\n  --   CAST(r.id AS integer),\n  --   'assistant' AS role,\n  --   CAST(jsonb_array_elements(r.result) ->> 'content' AS text) AS content,\n  --   CAST(r.conversation_id AS integer),\n  --   1 -(e.embedding <=> $1) AS similarity,\n  --   'research' AS source_type\n  -- FROM\n  --   memories e\n  --   JOIN research_tasks r ON e.source_id = CAST(r.id AS integer)\n  -- WHERE\n  --   1 -(e.embedding <=> $1) > $2\n  --   AND e.source = 'research'\n  --   AND content IS NOT NULL\n)\nSELECT\n  id,\n  ROLE,\n  content,\n  conversation_id,\n  similarity,\n  source_type\nFROM\n  unified_results\nORDER BY\n  similarity DESC\nLIMIT $3;\n\nEXECUTE myquery(\n'[0.002911948 0.075012125 -0.14121538 -0.040586386 0.08330209 -0.035778534 -0.003333435 -0.015705952 -0.050936826 0.017367277 -0.018377334 -0.0003244357 0.05051456 0.03867503 -0.008642751 0.0034129352 -0.013673342 -0.041001506 -0.010974273 0.016329644 -0.039958302 -0.04755674 0.027921502 -0.041165832 0.043722223 0.027132364 0.019857628 0.01176974 -0.06381539 0.018017959 0.047831368 -0.018071726 0.0031485958 -0.08659066 -0.07837665 -0.020359414 0.03801866 -0.0029141128 -0.00094265863 0.005713071 0.044884156 -0.025230749 0.013092588 0.0004575972 0.005954277 -0.03448284 0.10916001 -0.0675344 0.029023407 -0.026762621 0.047314327 0.06025646 0.0037041553 -0.03705043 0.0500391 0.011161987 -0.039275225 0.06008567 0.07637693 -0.0067847893 -0.014447138 0.0891366 -0.0290373 0.0015862498 0.041260105 0.013934064 -0.0076924097 -0.010784421 -0.03570047 -0.037895966 0.03322065 0.042003382 0.081075065 -0.022981932 -0.0064575085 -0.0174401 -0.00096942065 -0.02751166 -0.0344889 0.05538058 0.0370543 0.04596154 0.036122642 0.04682829 0.042185143 0.011922266 -0.031111766 0.003528767 -0.08422567 0.025718393 -0.0038978201 0.03198392 0.020785455 0.009434398 -0.059143692 -0.007451311 -0.056874517 0.047384992 -0.057158425 0.006500978 -0.013965377 -0.030137192 0.01585361 -0.06424701 -0.028822945 0.054359425 0.033143148 -0.005166531 0.02729925 -0.017028598 -0.020147396 -0.006898951 -0.05301948 0.002430746 0.008454771 -0.02736726 0.039069325 -0.04584878 -0.057429425 -0.007756828 -0.0020756437 -0.020995257 -0.055202678 0.0073543577 0.012083875 0.016455598 -0.0025963322 0.030506095 0.03674107 -0.01955806 0.052145094 -0.03556599 -0.012156498 0.038573407 -0.013822101 0.0638773 -0.03182266 0.0006958883 0.01301467 0.010261606 0.03025868 -0.038695287 -0.0718473 -0.011468329 0.07156258 -0.023445146 -0.011131099 -0.0014332874 -0.046687663 0.0044512446 -0.0044007427 0.0632732 -0.0031186494 0.021562826 0.054539934 -0.02751415 0.0065270327 -0.032776035 0.020437295 -0.044325475 0.051667813 -0.027350476 -0.012785687 0.04408364 -0.06051376 -0.06358542 -0.012520409 0.04003538 0.07389042 0.026261479 -0.046074737 -0.006709691 0.0048225396 -0.042961076 0.039814904 0.03963825 0.04802298 -0.013743941 -0.00991511 0.0007654183 0.02549563 -0.004154146 -0.0002754077 0.007565459 0.038605127 -0.024385354 0.024273224 -0.016158171 -0.031658236 -0.0022037274 -0.037834197 0.04989967 -0.016916057 -0.039070554 -0.044873342 -0.05164712 0.055754595 0.032163683 0.047396667 0.0011204238 -0.004918309 0.005841991 -0.063626796 0.0734236 -0.027467223 0.0091280835 -0.010836326 0.06803034 0.0017279614 -0.0026873886 0.029556576 0.0027496605 0.010080117 0.026487242 -0.00383864 -0.013878397 0.011242071 -0.031227412 -0.018700566 0.00495958 -0.00030471288 -0.0101275705 0.012673831 -0.03205615 0.0868599 -0.04638162 -0.009466553 0.025356956 -0.05008337 -0.0021125532 -0.03990484 -0.010371626 0.0012136145 -0.026513014 0.010062987 0.033610296 -0.01689197 0.056705896 -0.03974179 -0.03429258 0.036820546 0.04878819 -0.033137687 -0.005476488 -0.036693297 -0.0039758976 -0.012202189 -0.009043138 0.008535246 0.031113524 -0.019263443 -0.01202286 0.014252318 0.019460725 -0.00789975 -0.026935937 -0.008638622 -0.015394877 0.009829317 -0.014616834 0.012773757 0.029254075 0.0100223655 0.024037141 -0.027089532 -0.060708508 0.09736964 -0.07247622 -0.0128505705 -0.033771165 -0.006882301 0.04843568 0.012941779 0.012179133 -0.022223234 -0.0027135054 0.042041842 -0.030464815 -0.033528257 0.00034687697 -0.009972218 -0.060493253 -0.08812585 -0.033422604 0.036329407 -0.0076712607 0.008604166 0.0011757694 0.014380222 0.031114597 -0.008634782 0.016524203 0.032744337 -0.013102464 -0.019346446 -0.0074089733 0.016507654 0.011709634 0.042132657 -0.035375785 -0.03163046 -0.023908278 0.035313614 0.06258715 -0.02413721 -0.035129614 0.043060947 0.026801515 0.03904321 -0.02689138 -0.0025206879 -0.011665042 0.029654259 0.025041753 -0.0280162 -0.037523862 -0.019196928 -0.023374334 0.031144107 -0.017297495 -0.013912545 -0.021117333 0.028483154 -0.047748502 -0.013450755 0.111893065 -0.008101699 -0.024043206 0.015242034 0.033843137 -0.0072938297 -0.022408564 0.012662778 -0.036296245 -0.005290605 -0.027217073 -0.015851269 0.0042785313 0.039503336 0.036624145 0.034970224 0.011609637 0.01605645 -0.06479991 -0.03515834 -0.021407505 0.0113124475 -0.023815766 0.087917216 -0.011440909 -0.02377729 -0.0071731876 0.009844092 -0.010935355 0.027237616 -0.04621942 0.037295487 0.002047657 0.011873751 0.010692075 0.032287143 -0.008221179 0.03672015 -0.0021849426 0.04027115 0.0012133945 0.053509574 0.031617686 0.03732566 -0.031042019 0.0021951892 0.0002517501 -0.038101055 0.016978912 -0.00026057576 0.0053167786 -0.059763283 -0.036285434 0.0072820103 0.042748883 0.03313078 -0.028416216 0.00500517 -0.011027199 0.011329537 0.009795341 0.01774748 0.0038632553 -0.004210343 0.007305342 0.0015965805 -0.062476795 -0.09114791 0.028328216 0.0033666978 -0.05321319 0.0043638563 -0.032054324 -0.041979223 0.015183505 -0.03379002 -0.05452115 0.022516828 -0.019100262 -0.007920066 0.0025026577 0.00044559856 -0.040534943 0.03533659 0.037291866 0.010029663 0.015280385 -0.027988248 -0.061494943 0.04517266 0.010211226 0.043614462 0.057249434 -0.022825696 0.0029391486 0.019820265 0.004562495 -0.02387326 0.027342036 0.031345055 0.025212007 0.04091492 0.01628516 -0.01260808 -0.104966745 -0.009937413 0.014903516 0.007690684 -0.01476761 -0.014441932 -0.013387913 0.007744109 0.016659264 -0.041457098 0.04330552 0.06592956 0.0015928061 0.014845325 -0.026791522 0.07707628 0.042581283 0.03922923 -0.059731282 -0.057129055 0.017004158 -0.028346045 0.0002666456 -0.045675647 0.056602336 0.0593396 -0.01468548 -0.006688472 0.02656669 0.048772965 0.032248948 0.004927367 0.024106104 -0.043735128 0.005947971 0.002085608 -0.06542661 -0.048983064 -0.010958396 0.046837095 0.05497056 -0.03808655 0.017822756 0.00859465 0.017074026 0.02442189 -0.042982657 -0.016820323 0.0115965335 0.053311065 0.017971711 0.035545375 0.018090175 0.050432373 -0.06422894 0.02412716 0.08065337 0.018564668 -0.01260353 0.0149965 -0.011896859 0.03323328 0.031311803 0.004071715 0.020892452 -0.001248631-0.032446813 0.030701956 0.0005878347 0.009359849 0.0095753195 0.05014334 0.033753097 0.041936148 -0.026876232 0.061545957 -0.028642787 0.01815142 -0.08141369 -0.050198037 0.0015995627 -0.030569572 -0.017330898 0.03563798 0.028950049 0.003078089 -0.092591725 -0.0052107815 -0.011354249 -0.022736648 -0.06478634 0.0052167256 -0.09577888 -0.052929755 0.005948745 -0.036528196 0.06095557 0.0030567404 -0.047924347 0.022787362 -0.0052050673 0.007168512 0.025014307 -0.07709777 0.043092117 0.013921342 -0.06129789 -0.04032326 0.030516084 0.042630106 0.008473224 0.017716298 0.020719327 0.03400632 0.006111611 -0.018968081 -0.02044928 -0.026694339 0.027231958 0.05209805 -0.066399425 0.048928015 -0.058903113 0.01285461 -0.012060062 0.0799707 -0.018413873 -0.05920367 -0.104325764 -0.003215215 0.015469097 -0.020355755 0.017706214 0.059714 -0.018642228 -0.013502421 -0.0076841493 0.003569193 0.010785929 0.04050947 0.0027140398 0.026182244 -0.062377173 0.037001017 -0.001211254 0.010199349 0.002680826 0.027561583 0.054357715 -0.029756546 -0.023976179 -0.009877403 -0.0011941998 0.022660442 0.05201542 -0.023103891 0.066086665 0.00014024608 -0.010774982 -0.012389223 -0.013841132 0.018541235 -0.06293032 -0.00010862949 -0.009917752 0.023844447 0.037142288 -0.048238017 -0.017618364 0.0032699762 -0.060296223 0.048522543 0.034896918 0.031652424 -0.0752769 -0.036314297 0.08318682 -0.027824553 0.006423727 0.008212088 0.005028536 -0.028540375 -0.017169856 -0.061659813 -0.014350004 0.01954649 -0.017870529 0.03802914 -0.0058750883 -0.012828261 -0.042811953 0.00063706166 -0.044982214 0.037651144 -0.06757146 0.026190849 0.014960936 -0.08384994 -0.045815263 0.058239635 0.05532802 -0.002811322 0.0059506707 -0.05764396 -0.012465318 -0.022903122 0.042729273 -0.033756845 0.037106894 0.030432707 0.08538293 0.05362069 0.011728015 -0.002515404 0.018972777 0.031808514 0.011832942 0.06299262 0.05135355 0.026241554 -0.0058325003 0.028448336 0.058537144 -0.011776445 0.05326051 -0.08081552 -0.022498863 0.00941705 -0.029387662 -0.06162396 -0.017620537 -0.07259887 -0.0018173013 -0.017585134 0.004322283 0.031654973 0.017700728 0.0039891265 -0.0021764815 -0.06872933 -0.04595656 -0.017484646 0.008839718 -0.028556127 0.02843662 0.01240145 -0.011686395 0.03253374 0.02643355 -0.013226884 -0.07022468 0.02357477 0.06707581 0.005426372 0.002772399 -0.020950863 -0.025130011 0.020402882 0.019803109 -0.018819826 -0.017813668 -0.028609632 -0.016186062 0.053330954 -0.0034477203 -0.07965534 0.047423754 -0.0164446 0.017480345 0.016630735 0.08242877 -0.0023118262 0.038371682 0.04758957 0.0014446835 -0.02615926 -0.0218262 0.011668442 -0.010242197 0.030328583 -0.074310064 -0.04678025 0.06581109 -0.022595542 0.013780781 -0.0052738357 -0.007987573 -0.059456438 -0.041749474 -0.004128156 0.035191167 0.017519096 -0.007676557 -0.07252055 0.02133768 0.028149225 -0.04459788 0.022519613 -0.0012048932 0.028944448 0.0143225845 -0.02433382 0.020322807 -0.018620146 0.06716366 0.0049465843 0.017961074 -0.028931301 -0.033605445 -0.037831046 2.903528e-05 -0.060818136 -0.013549915 -0.023265457 -0.0071604312 -0.009996195 -0.015595496 -0.047199115 0.017656965 0.037837908 -0.0071930303 0.0005079127 -0.028087106 -0.005965163 -0.008095759 0.0014591401 -0.0030669195 0.027997252 0.050193213 0.04512683 0.006632524 -0.03529536 0.0054428154 -0.0008170922 0.011585934 -0.031452313 -0.02998615 -0.016218645 0.00652318]',\n0.7,\n10\n);\n```\nERROR:  invalid input syntax for type vector: \"[0.002911948 0.075012125 -0.14121538 -0.040586386 0.08330209 -0.035778534 -0.003333435 -0.015705952 -0.050936826 0.017367277 -0.018377334 -0.0003244357 0.05051456 0.03867503 -0.008642751 0.0034129352 -0.013673342 -0.041001506 -0.010974273 0.016329644 -0.039958302 -0.04755674 0.027921502 -0.041165832 0.043722223 0.027132364 0.019857628 0.01176974 -0.06381539 0.018017959 0.047831368 -0.018071726 0.0031485958 -0.08659066 -0.07837665 -0.020359414 0.03801866 -0.0029141128 -0.00094265863 0.005713071 0.044884156 -0.025230749 0.013092588 0.0004575972 0.005954277 -0.03448284 0.10916001 -0.0675344 0.029023407 -0.026762621 0.047314327 0.06025646 0.0037041553 -0.03705043 0.0500391 0.011161987 -0.039275225 0.06008567 0.07637693 -0.0067847893 -0.014447138 0.0891366 -0.0290373 0.0015862498 0.041260105 0.013934064 -0.0076924097 -0.010784421 -0.03570047 -0.037895966 0.03322065 0.042003382 0.081075065 -0.022981932 -0.0064575085 -0.0174401 -0.00096942065 -0.02751166 -0.0344889 0.05538058 0.0370543 0.04596154 0.036122642 0.04682829 0.042185143 0.011922266 -0.031111766 0.003528767 -0.08422567 0.025718393 -0.0038978201 0.03198392 0.020785455 0.009434398 -0.059143692 -0.007451311 -0.056874517 0.047384992 -0.057158425 0.006500978 -0.013965377 -0.030137192 0.01585361 -0.06424701 -0.028822945 0.054359425 0.033143148 -0.005166531 0.02729925 -0.017028598 -0.020147396 -0.006898951 -0.05301948 0.002430746 0.008454771 -0.02736726 0.039069325 -0.04584878 -0.057429425 -0.007756828 -0.0020756437 -0.020995257 -0.055202678 0.0073543577 0.012083875 0.016455598 -0.0025963322 0.030506095 0.03674107 -0.01955806 0.052145094 -0.03556599 -0.012156498 0.038573407 -0.013822101 0.0638773 -0.03182266 0.0006958883 0.01301467 0.010261606 0.03025868 -0.038695287 -0.0718473 -0.011468329 0.07156258 -0.023445146 -0.011131099 -0.0014332874 -0.046687663 0.0044512446 -0.0044007427 0.0632732 -0.0031186494 0.021562826 0.054539934 -0.02751415 0.0065270327 -0.032776035 0.020437295 -0.044325475 0.051667813 -0.027350476 -0.012785687 0.04408364 -0.06051376 -0.06358542 -0.012520409 0.04003538 0.07389042 0.026261479 -0.046074737 -0.006709691 0.0048225396 -0.042961076 0.039814904 0.03963825 0.04802298 -0.013743941 -0.00991511 0.0007654183 0.02549563 -0.004154146 -0.0002754077 0.007565459 0.038605127 -0.024385354 0.024273224 -0.016158171 -0.031658236 -0.0022037274 -0.037834197 0.04989967 -0.016916057 -0.039070554 -0.044873342 -0.05164712 0.055754595 0.032163683 0.047396667 0.0011204238 -0.004918309 0.005841991 -0.063626796 0.0734236 -0.027467223 0.0091280835 -0.010836326 0.06803034 0.0017279614 -0.0026873886 0.029556576 0.0027496605 0.010080117 0.026487242 -0.00383864 -0.013878397 0.011242071 -0.031227412 -0.018700566 0.00495958 -0.00030471288 -0.0101275705 0.012673831 -0.03205615 0.0868599 -0.04638162 -0.009466553 0.025356956 -0.05008337 -0.0021125532 -0.03990484 -0.010371626 0.0012136145 -0.026513014 0.010062987 0.033610296 -0.01689197 0.056705896 -0.03974179 -0.03429258 0.036820546 0.04878819 -0.033137687 -0.005476488 -0.036693297 -0.0039758976 -0.012202189 -0.009043138 0.008535246 0.031113524 -0.019263443 -0.01202286 0.014252318 0.019460725 -0.00789975 -0.026935937 -0.008638622 -0.015394877 0.009829317 -0.014616834 0.012773757 0.029254075 0.0100223655 0.024037141 -0.027089532 -0.060708508 0.09736964 -0.07247622 -0.0128505705 -0.033771165 -0.006882301 0.04843568 0.012941779 0.012179133 -0.022223234 -0.0027135054 0.042041842 -0.030464815 -0.033528257 0.00034687697 -0.009972218 -0.060493253 -0.08812585 -0.033422604 0.036329407 -0.0076712607 0.008604166 0.0011757694 0.014380222 0.031114597 -0.008634782 0.016524203 0.032744337 -0.013102464 -0.019346446 -0.0074089733 0.016507654 0.011709634 0.042132657 -0.035375785 -0.03163046 -0.023908278 0.035313614 0.06258715 -0.02413721 -0.035129614 0.043060947 0.026801515 0.03904321 -0.02689138 -0.0025206879 -0.011665042 0.029654259 0.025041753 -0.0280162 -0.037523862 -0.019196928 -0.023374334 0.031144107 -0.017297495 -0.013912545 -0.021117333 0.028483154 -0.047748502 -0.013450755 0.111893065 -0.008101699 -0.024043206 0.015242034 0.033843137 -0.0072938297 -0.022408564 0.012662778 -0.036296245 -0.005290605 -0.027217073 -0.015851269 0.0042785313 0.039503336 0.036624145 0.034970224 0.011609637 0.01605645 -0.06479991 -0.03515834 -0.021407505 0.0113124475 -0.023815766 0.087917216 -0.011440909 -0.02377729 -0.0071731876 0.009844092 -0.010935355 0.027237616 -0.04621942 0.037295487 0.002047657 0.011873751 0.010692075 0.032287143 -0.008221179 0.03672015 -0.0021849426 0.04027115 0.0012133945 0.053509574 0.031617686 0.03732566 -0.031042019 0.0021951892 0.0002517501 -0.038101055 0.016978912 -0.00026057576 0.0053167786 -0.059763283 -0.036285434 0.0072820103 0.042748883 0.03313078 -0.028416216 0.00500517 -0.011027199 0.011329537 0.009795341 0.01774748 0.0038632553 -0.004210343 0.007305342 0.0015965805 -0.062476795 -0.09114791 0.028328216 0.0033666978 -0.05321319 0.0043638563 -0.032054324 -0.041979223 0.015183505 -0.03379002 -0.05452115 0.022516828 -0.019100262 -0.007920066 0.0025026577 0.00044559856 -0.040534943 0.03533659 0.037291866 0.010029663 0.015280385 -0.027988248 -0.061494943 0.04517266 0.010211226 0.043614462 0.057249434 -0.022825696 0.0029391486 0.019820265 0.004562495 -0.02387326 0.027342036 0.031345055 0.025212007 0.04091492 0.01628516 -0.01260808 -0.104966745 -0.009937413 0.014903516 0.007690684 -0.01476761 -0.014441932 -0.013387913 0.007744109 0.016659264 -0.041457098 0.04330552 0.06592956 0.0015928061 0.014845325 -0.026791522 0.07707628 0.042581283 0.03922923 -0.059731282 -0.057129055 0.017004158 -0.028346045 0.0002666456 -0.045675647 0.056602336 0.0593396 -0.01468548 -0.006688472 0.02656669 0.048772965 0.032248948 0.004927367 0.024106104 -0.043735128 0.005947971 0.002085608 -0.06542661 -0.048983064 -0.010958396 0.046837095 0.05497056 -0.03808655 0.017822756 0.00859465 0.017074026 0.02442189 -0.042982657 -0.016820323 0.0115965335 0.053311065 0.017971711 0.035545375 0.018090175 0.050432373 -0.06422894 0.02412716 0.08065337 0.018564668 -0.01260353 0.0149965 -0.011896859 0.03323328 0.031311803 0.004071715 0.020892452 -0.001248631-0.032446813 0.030701956 0.0005878347 0.009359849 0.0095753195 0.05014334 0.033753097 0.041936148 -0.026876232 0.061545957 -0.028642787 0.01815142 -0.08141369 -0.050198037 0.0015995627 -0.030569572 -0.017330898 0.03563798 0.028950049 0.003078089 -0.092591725 -0.0052107815 -0.011354249 -0.022736648 -0.06478634 0.0052167256 -0.09577888 -0.052929755 0.005948745 -0.036528196 0.06095557 0.0030567404 -0.047924347 0.022787362 -0.0052050673 0.007168512 0.025014307 -0.07709777 0.043092117 0.013921342 -0.06129789 -0.04032326 0.030516084 0.042630106 0.008473224 0.017716298 0.020719327 0.03400632 0.006111611 -0.018968081 -0.02044928 -0.026694339 0.027231958 0.05209805 -0.066399425 0.048928015 -0.058903113 0.01285461 -0.012060062 0.0799707 -0.018413873 -0.05920367 -0.104325764 -0.003215215 0.015469097 -0.020355755 0.017706214 0.059714 -0.018642228 -0.013502421 -0.0076841493 0.003569193 0.010785929 0.04050947 0.0027140398 0.026182244 -0.062377173 0.037001017 -0.001211254 0.010199349 0.002680826 0.027561583 0.054357715 -0.029756546 -0.023976179 -0.009877403 -0.0011941998 0.022660442 0.05201542 -0.023103891 0.066086665 0.00014024608 -0.010774982 -0.012389223 -0.013841132 0.018541235 -0.06293032 -0.00010862949 -0.009917752 0.023844447 0.037142288 -0.048238017 -0.017618364 0.0032699762 -0.060296223 0.048522543 0.034896918 0.031652424 -0.0752769 -0.036314297 0.08318682 -0.027824553 0.006423727 0.008212088 0.005028536 -0.028540375 -0.017169856 -0.061659813 -0.014350004 0.01954649 -0.017870529 0.03802914 -0.0058750883 -0.012828261 -0.042811953 0.00063706166 -0.044982214 0.037651144 -0.06757146 0.026190849 0.014960936 -0.08384994 -0.045815263 0.058239635 0.05532802 -0.002811322 0.0059506707 -0.05764396 -0.012465318 -0.022903122 0.042729273 -0.033756845 0.037106894 0.030432707 0.08538293 0.05362069 0.011728015 -0.002515404 0.018972777 0.031808514 0.011832942 0.06299262 0.05135355 0.026241554 -0.0058325003 0.028448336 0.058537144 -0.011776445 0.05326051 -0.08081552 -0.022498863 0.00941705 -0.029387662 -0.06162396 -0.017620537 -0.07259887 -0.0018173013 -0.017585134 0.004322283 0.031654973 0.017700728 0.0039891265 -0.0021764815 -0.06872933 -0.04595656 -0.017484646 0.008839718 -0.028556127 0.02843662 0.01240145 -0.011686395 0.03253374 0.02643355 -0.013226884 -0.07022468 0.02357477 0.06707581 0.005426372 0.002772399 -0.020950863 -0.025130011 0.020402882 0.019803109 -0.018819826 -0.017813668 -0.028609632 -0.016186062 0.053330954 -0.0034477203 -0.07965534 0.047423754 -0.0164446 0.017480345 0.016630735 0.08242877 -0.0023118262 0.038371682 0.04758957 0.0014446835 -0.02615926 -0.0218262 0.011668442 -0.010242197 0.030328583 -0.074310064 -0.04678025 0.06581109 -0.022595542 0.013780781 -0.0052738357 -0.007987573 -0.059456438 -0.041749474 -0.004128156 0.035191167 0.017519096 -0.007676557 -0.07252055 0.02133768 0.028149225 -0.04459788 0.022519613 -0.0012048932 0.028944448 0.0143225845 -0.02433382 0.020322807 -0.018620146 0.06716366 0.0049465843 0.017961074 -0.028931301 -0.033605445 -0.037831046 2.903528e-05 -0.060818136 -0.013549915 -0.023265457 -0.0071604312 -0.009996195 -0.015595496 -0.047199115 0.017656965 0.037837908 -0.0071930303 0.0005079127 -0.028087106 -0.005965163 -0.008095759 0.0014591401 -0.0030669195 0.027997252 0.050193213 0.04512683 0.006632524 -0.03529536 0.0054428154 -0.0008170922 0.011585934 -0.031452313 -0.02998615 -0.016218645 0.00652318]\"\nLINE 69: '[0.002911948 0.075012125 -0.14121538 -0.040586386 0.0833020...\n         ^ \n\nSQL state: 22P02\nCharacter: 1551"

func Test_fmtQuery(t *testing.T) {
	test.Init()
	ctx := context.Background()

	result, err := FmtQuery(ctx, &config.DefaultFormattingProfile, query, SearchFmtPrompt)
	if err != nil {
		t.Fatalf("Expected no error, got %v", err)
	}

	t.Log("Formatted query:", result)
}
